<html>
<div id="result" style="font-size: large"></div>
<script>

// this program does a lot of random selection of array elements.
function get_random_element(x)
{
  return x[Math.floor(Math.random() * x.length)];
}

function generate_new_practice()
{
  // lhs is the full enumeration of the scales I need to memorize
  // rhs is its half-step "pair"
  // I have found it helpful to study them as pairs
  var scales = [];
  scales["G Major"]      = "A-flat Major";
  scales["A-flat Major"] = "G Major";
  scales["D Major"]      = "D-flat Major";
  scales["D-flat Major"] = "D Major";
  scales["E Minor"]      = "F Minor";
  scales["F Minor"]      = "E Minor";
  scales["B Minor"]      = "B-flat Minor";
  scales["B-flat Minor"] = "B Minor";

  var scale1 = get_random_element(Object.keys(scales));
  var scale2 = scales[scale1];

  // the exam requires a lot of variations of the scales
  tremolando = Math.random() > (2/3); // equal practice for triplets, sixteenth notes and tremolando  
  if (tremolando)
  {
	var note_value = "triplet @ 88";
  }
  else
  {
	var note_value = get_random_element(["triplet @ 69", "16th note @ 69"]);
  }
  var stroke     = get_random_element(["Rest Stroke", "Free Stroke"]);
  var fingering  = get_random_element(["im", "ma", "ia"]);

  // lhs is the full enumeration of the arpeggios I need to memorize
  // rhs is its complement or "pair"
  // I have found it helpful to study them as pairs  
  var arpeggios = [];
  arpeggios["p-i-m-a ascending"]                  = "p-a-m-i descending";
  arpeggios["p-a-m-i descending"]                 = "p-i-m-a ascending";
  arpeggios["p-i-m-i pattern"]                    = "p-m-i-m pattern ";
  arpeggios["p-m-i-m pattern"]                    = "p-i-m-i pattern";
  arpeggios["ascending and descending sextuplet"] = "descending and ascending sextuplet";
  arpeggios["descending and ascending sextuplet"] = "ascending and descending sextuplet";
  arpeggios["p-a dyad-m-i triplet pattern"]       = "p-i dyad-m-a triplet pattern";
  arpeggios["p-i dyad-m-a triplet pattern"]       = "p-a dyad-m-i triplet pattern";
  arpeggios["p-m dyad-i-a triplet pattern"]       = "p-i dyad-a-m triplet pattern";
  arpeggios["p-i dyad-a-m triplet pattern"]       = "p-m dyad-i-a triplet pattern ";

  var arpeggio1 = get_random_element(Object.keys(arpeggios));
  var arpeggio2 = arpeggios[arpeggio1];

  var arpeggio_speed = "";
  if (arpeggio1.indexOf("sextuplet") !== -1)
  {
	arpeggio_speed = 52;
  }
  else
  {
	arpeggio_speed = 76;
  }

  // the pieces I am required to memorize
  var piece = get_random_element(
    ["Bach Minuet",
    "Paganini Minuet",
    "Spanish Romance"]);

  // the studies I am required to memorize
  var study = get_random_element(
    ["Carcassi Tremolo Study",
    "Bosch Lamento"]);

  // output!
  scale_output    = "<b>Scales: </b>" + scale1 + " and " + scale2 + ". " + note_value + ", " + stroke + ", " + fingering;
  if (tremolando)
  {
    scale_output = scale_output + ". Tremolando";	
  }
  arpeggio_output = "<b>Arpeggio: </b>" + arpeggio1 + " and " + arpeggio2 + " at " + arpeggio_speed;
  piece_output    = "<b>Piece: </b>" + piece;
  study_output    = "<b>Study: </b>" + study;

  return "<p>" + scale_output    + "</p>" +
         "<p>" + arpeggio_output + "</p>" +
         "<p>" + piece_output    + "</p>" +
         "<p>" + study_output    + "</p>";
}

cached_practice = localStorage.getItem("cached_practice")
cached_practice_date = localStorage.getItem("cached_practice_date")

var today = new Date().getDate();

// if we can use a cached practice, then do so
if (cached_practice != null &&
    cached_practice_date == today)
{
  document.getElementById("result").innerHTML = cached_practice;
}
// otherwise create a new one and save it
else
{
  new_practice = generate_new_practice();
  document.getElementById("result").innerHTML = new_practice;
  localStorage.setItem("cached_practice", new_practice);
  localStorage.setItem("cached_practice_date", today);
}

</script>
</html>
